<html>

<head>

 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
     integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14="
     crossorigin=""/>
	 
	  <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
     integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg="
     crossorigin=""></script>
 <script src="capitalcities.js"></script>
</head>

<style>

		html, body {
			height: 100%;
			margin: 0;
		}
		.leaflet-container {
			height: 400px;
			width: 600px;
			max-width: 100%;
			max-height: 100%;
		}
#map { width: 600px; height: 400px;}

</style>
<body>

<h1>Countries to Pray for Today</h1>
<p id="todayDate"></p>
<ol id="list">
 
</ol>

 <div id="map"></div>

</body>


<script>
	var map = L.map('map').setView([51.505, -0.09], 7);
	var tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(map);
	
    var capitalcities = getCapitalCities();
	console.log(capitalcities);
	



   function filterItems(arr, query) {
      return arr.filter((el) => el["CountryName"].toLowerCase().replace(" ", "").includes(query.toLowerCase().replace(" ", "")));
   }

   function addMarkers(country){

    try{

     var countryObj = filterItems(capitalcities, country)[0];
     var latitude = countryObj["CapitalLatitude"];
     var longitude = countryObj["CapitalLongitude"];
     console.log(latitude); // ['apple', 'grapes']
     console.log(longitude); // ['apple', 'grapes']
     var marker = L.marker([latitude, longitude]).addTo(map);
    }catch (err){
      console.log(err);
    }
   }
   
   function goToCountry(country){

      try{
	  
	   var countryObj = filterItems(capitalcities, country)[0];
	   var latitude = countryObj["CapitalLatitude"];
	   var longitude = countryObj["CapitalLongitude"];
	   console.log(latitude); // ['apple', 'grapes']
	   console.log(longitude); // ['apple', 'grapes']   
       map.panTo(new L.LatLng(latitude, longitude));	   
	  }catch (err){
        console.log(err);
      }	  
   }
   


	
/*
	var circle = L.circle([51.508, -0.11], {
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.5,
		radius: 500
	}).addTo(map);
*/

	
function onMapClick(e) {
    alert("You clicked the map at " + e.zoom);
}

map.on('click', onMapClick);	
function loadDoc() {
  const xhttp = new XMLHttpRequest();
  xhttp.onload = function() {
    var jsondata = JSON.parse(this.responseText);
	document.getElementById("todayDate").innerHTML = jsondata["startDate"];
	var olEl = document.getElementById("list");
	for (let country in jsondata["countries"]){
	  console.log(country);
		 if (country==="USA"){
		          addMarkers("United States");

		 }else{
		    		          addMarkers(country);

		 }
	  var liEl = document.createElement("LI");
	  liEl.style.cursor = "pointer";
	  liEl.id = country;
	  
	  liEl.innerHTML = country + ": " + jsondata["countries"][country];
	  liEl.onclick = function (evt) {
	     console.log(evt.target.id);
		 if (evt.target.id==="USA"){
		          goToCountry("United States");

		
		 }else{
		    		          goToCountry(evt.target.id);

		 }
      };   
	  olEl.appendChild(liEl);
	}
    //document.getElementById("demo").innerHTML = this.responseText;
  }
  xhttp.open("GET", "countries.json");
  xhttp.send();
}

loadDoc();
</script>

</html>